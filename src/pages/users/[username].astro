---
import AppLayout from '../../layouts/AppLayout.astro';
import { getUserProfile } from '../../data/users.ts';
import { RoleBadge } from '../../components/wiki/RoleBadge.tsx';

const { username } = Astro.params;
const profile = username ? getUserProfile(username) : undefined;

if (!profile) {
  return new Response('User not found', {
    status: 404,
  });
}
---

<AppLayout title={`${profile.displayName} — Profile`} description={`Contribution history for ${profile.displayName}`}>
  <section class="rounded border border-[#a2a9b1] bg-white p-5 shadow-sm">
    <header class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div>
        <h1 class="text-[1.75rem] font-normal text-[#202122]">{profile.displayName}</h1>
        <p class="text-sm text-[#54595d]">@{profile.username} · Joined {new Date(profile.joinedAt).toLocaleDateString()}</p>
      </div>
      <RoleBadge role={profile.role} />
    </header>
    <p class="mt-3 text-sm text-[#202122]">{profile.bio}</p>

    <div class="mt-4 grid gap-4 md:grid-cols-3">
      <div class="rounded border border-[#c8ccd1] bg-[#f8f9fa] p-4 text-center">
        <p class="text-xs uppercase tracking-[0.3em] text-[#72777d]">Reputation</p>
        <p class="mt-2 text-3xl font-semibold text-[#202122]">{profile.reputation}</p>
      </div>
      <div class="rounded border border-[#c8ccd1] bg-[#f8f9fa] p-4 text-center md:col-span-2">
        <p class="text-xs uppercase tracking-[0.3em] text-[#72777d]">Badges</p>
        <div class="mt-2 flex flex-wrap justify-center gap-2 text-xs">
          {profile.badges.map((badge) => (
            <span class="rounded-full border border-[#a2a9b1] bg-white px-3 py-1 text-[#202122]">{badge}</span>
          ))}
        </div>
      </div>
    </div>
  </section>

  <section class="mt-4 rounded border border-[#a2a9b1] bg-white p-5 shadow-sm">
    <h2 class="text-lg font-semibold text-[#202122]">Contribution activity</h2>
    <p class="text-xs text-[#54595d]">Latest edits and proposals across the wiki.</p>
    <ul class="mt-3 space-y-3 text-sm text-[#202122]">
      {profile.contributions.map((contribution) => (
        <li class="rounded border border-[#c8ccd1] bg-[#f8f9fa] p-4">
          <div class="flex flex-wrap items-center justify-between gap-2">
            <a class="font-semibold text-[#0645ad]" href={`/wiki/${contribution.articleSlug}`}>
              {contribution.articleTitle}
            </a>
            <span class="text-xs text-[#72777d]">{new Date(contribution.editedAt).toLocaleString()}</span>
          </div>
          <p class="mt-1 text-sm text-[#202122]">{contribution.summary}</p>
        </li>
      ))}
    </ul>
  </section>
</AppLayout>

